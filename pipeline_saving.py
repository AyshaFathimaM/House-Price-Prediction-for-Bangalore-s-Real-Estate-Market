# -*- coding: utf-8 -*-
"""pipeline_saving.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1euwcg1i4w6wgZukaZvqc3l8w3MCziBLM
"""

from data_processing import preprocess_data, load_data
from model_selection import tune_model
from sklearn.model_selection import train_test_split
import pickle

def save_pipeline(pipeline, file_name):
    """Save the trained pipeline."""
    with open(file_name, "wb") as f:
        pickle.dump(pipeline, f)

def main(file_path, output_file):
    """Main function to load, preprocess, and train the model pipeline."""
    print("Loading and preprocessing data...")
    # Ensure load_data takes the file_path argument
    data = preprocess_data(load_data(file_path))
    X = data.drop("price", axis=1)
    y = data["price"]

    print("Splitting data into training and test sets...")
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

    print("Tuning and training the model...")
    best_model = tune_model(X_train, y_train)

    print("Saving the trained model pipeline...")
    save_pipeline(best_model, output_file)

if __name__ == "__main__":
    DATA_FILE = r"C:\Users\Indra\Desktop\Praxis\Term 2\MLOPS\Bangalore Housing\Bengaluru_House_Data.csv"
    OUTPUT_FILE = "best_xgb_model.pkl"
    main(DATA_FILE, OUTPUT_FILE)

